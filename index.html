<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tennis Match Manager</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Login Overlay -->
    <div id="login-overlay" class="login-overlay">
        <div class="login-box">
            <div class="login-icon">ğŸ¾</div>
            <h2>Area Admin</h2>
            <p>Inserisci la password per accedere</p>
            <input type="password" id="admin-password" placeholder="Password"
                onkeypress="if(event.key==='Enter') checkAdminPassword()">
            <button onclick="checkAdminPassword()" class="btn btn-primary">Accedi</button>
            <p id="login-error" style="color: #ef4444; display: none; margin-top: 10px;">Password errata!</p>
            <a href="public.html" class="public-link">ğŸ“º Vai alla vista pubblica</a>
        </div>
    </div>

    <div class="app-container" id="app-container" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">
                <span class="logo-icon">ğŸ¾</span>
                <h1>Tennis <span style="color: var(--primary);">Planning</span></h1>
            </div>

            <div class="season-toggle">
                <label class="toggle-label">
                    <span>Circolo Tennis:</span>
                    <select id="season-select" onchange="App.handleSeasonChange()">
                        <option value="winter">Viserba (4 campi)</option>
                        <option value="summer">Rivabella (2 campi)</option>
                    </select>
                </label>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="main-nav">
            <button class="nav-btn admin-only" data-tab="dashboard" style="display: none;">
                <span class="nav-icon">ğŸ“Š</span>
                Dashboard
            </button>
            <button class="nav-btn non-admin-only" data-tab="dashboard">
                <span class="nav-icon">ğŸ </span>
                Home
            </button>
            <button class="nav-btn" data-tab="players">
                <span class="nav-icon">ğŸ‘¥</span>
                Giocatori
            </button>
            <button class="nav-btn" data-tab="courts">
                <span class="nav-icon">ğŸŸï¸</span>
                Campi
            </button>

            <button class="nav-btn" data-tab="planning">
                <span class="nav-icon">ğŸ“…</span>
                Planning
            </button>
            <button class="nav-btn admin-only" data-tab="recurring" style="display: none;">
                <span class="nav-icon">ğŸ”</span>
                Ricorrente
            </button>
            <button class="nav-btn admin-only" data-tab="history" style="display: none;">
                <span class="nav-icon">ğŸ“ˆ</span>
                Statistiche
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Tab -->
            <section id="dashboard" class="tab-content active">
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ‘¥</div>
                        <div class="stat-info">
                            <span class="stat-value" id="total-players">0</span>
                            <span class="stat-label">Giocatori</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸŸï¸</div>
                        <div class="stat-info">
                            <span class="stat-value" id="total-courts">0</span>
                            <span class="stat-label">Campi Attivi</span>
                        </div>
                    </div>
                </div>

                <!-- Rates summary table - shown on mobile for all, on desktop for non-admin only -->
                <div class="section-card rates-readonly-section" id="rates-summary-mobile" style="margin-top: 20px;">
                    <h3>ğŸ’° Tariffe e Stagioni</h3>
                    <div id="mobile-rates-table">
                        <!-- Will be populated by JavaScript -->
                        <p style="color: var(--text-muted); text-align: center;">Caricamento...</p>
                    </div>
                </div>

                <!-- Court Rates Settings - hidden on mobile, editable only by admin -->
                <div class="section-card desktop-only admin-only" style="margin-top: 20px; display: none;">
                    <h3>ğŸ’° Tariffe e Fasce Orarie</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9rem;">
                        Definisci le stagioni, gli orari delle fasce e le relative tariffe.
                    </p>

                    <!-- Season dates -->
                    <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--text-primary);">ğŸ“… Stagioni</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>â„ï¸ Inizio stagione campi coperti</label>
                                <input type="date" id="season-covered-start" style="width: 100%;">
                            </div>
                            <div class="form-group">
                                <label>â˜€ï¸ Inizio stagione campi scoperti</label>
                                <input type="date" id="season-uncovered-start" style="width: 100%;">
                            </div>
                        </div>
                    </div>

                    <!-- Time Slots Definition -->
                    <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--text-primary);">â° Definizione Fasce Orarie</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>ğŸŒ… Inizio Mattina</label>
                                <input type="time" id="slot-morning-start" value="08:00" style="width: 100%;">
                            </div>
                            <div class="form-group">
                                <label>â˜€ï¸ Inizio Pomeriggio</label>
                                <input type="time" id="slot-afternoon-start" value="13:00" style="width: 100%;">
                            </div>
                            <div class="form-group">
                                <label>ğŸŒ™ Inizio Sera</label>
                                <input type="time" id="slot-evening-start" value="19:00" style="width: 100%;">
                            </div>
                        </div>
                    </div>

                    <!-- Rates Matrix -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <!-- Covered Court Rates -->
                        <div class="rate-group"
                            style="background: rgba(96, 165, 250, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(96, 165, 250, 0.3);">
                            <h4
                                style="color: #60a5fa; margin-bottom: 15px; border-bottom: 1px solid rgba(96, 165, 250, 0.3); padding-bottom: 5px;">
                                â„ï¸ Campo Coperto</h4>

                            <div style="margin-bottom: 15px;">
                                <h5 style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.85rem;">ğŸŒ…
                                    Mattina</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div class="form-group"><label>ğŸ… Socio</label><input type="number"
                                            id="rate-covered-morning-member" class="payment-input" style="width: 100%;"
                                            step="0.5"></div>
                                    <div class="form-group"><label>ğŸ‘¤ Non Socio</label><input type="number"
                                            id="rate-covered-morning-nonmember" class="payment-input"
                                            style="width: 100%;" step="0.5"></div>
                                </div>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <h5 style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.85rem;">â˜€ï¸
                                    Pomeriggio</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div class="form-group"><label>ğŸ… Socio</label><input type="number"
                                            id="rate-covered-afternoon-member" class="payment-input"
                                            style="width: 100%;" step="0.5"></div>
                                    <div class="form-group"><label>ğŸ‘¤ Non Socio</label><input type="number"
                                            id="rate-covered-afternoon-nonmember" class="payment-input"
                                            style="width: 100%;" step="0.5"></div>
                                </div>
                            </div>

                            <div>
                                <h5 style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.85rem;">ğŸŒ™
                                    Sera</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div class="form-group"><label>ğŸ… Socio</label><input type="number"
                                            id="rate-covered-evening-member" class="payment-input" style="width: 100%;"
                                            step="0.5"></div>
                                    <div class="form-group"><label>ğŸ‘¤ Non Socio</label><input type="number"
                                            id="rate-covered-evening-nonmember" class="payment-input"
                                            style="width: 100%;" step="0.5"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Uncovered Court Rates -->
                        <div class="rate-group"
                            style="background: rgba(248, 113, 113, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(248, 113, 113, 0.3);">
                            <h4
                                style="color: #f87171; margin-bottom: 15px; border-bottom: 1px solid rgba(248, 113, 113, 0.3); padding-bottom: 5px;">
                                â˜€ï¸ Campo Scoperto</h4>

                            <div style="margin-bottom: 15px;">
                                <h5 style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.85rem;">ğŸŒ…
                                    Mattina</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div class="form-group"><label>ğŸ… Socio</label><input type="number"
                                            id="rate-uncovered-morning-member" class="payment-input"
                                            style="width: 100%;" step="0.5"></div>
                                    <div class="form-group"><label>ğŸ‘¤ Non Socio</label><input type="number"
                                            id="rate-uncovered-morning-nonmember" class="payment-input"
                                            style="width: 100%;" step="0.5"></div>
                                </div>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <h5 style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.85rem;">â˜€ï¸
                                    Pomeriggio</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div class="form-group"><label>ğŸ… Socio</label><input type="number"
                                            id="rate-uncovered-afternoon-member" class="payment-input"
                                            style="width: 100%;" step="0.5"></div>
                                    <div class="form-group"><label>ğŸ‘¤ Non Socio</label><input type="number"
                                            id="rate-uncovered-afternoon-nonmember" class="payment-input"
                                            style="width: 100%;" step="0.5"></div>
                                </div>
                            </div>

                            <div>
                                <h5 style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.85rem;">ğŸŒ™
                                    Sera</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div class="form-group"><label>ğŸ… Socio</label><input type="number"
                                            id="rate-uncovered-evening-member" class="payment-input"
                                            style="width: 100%;" step="0.5"></div>
                                    <div class="form-group"><label>ğŸ‘¤ Non Socio</label><input type="number"
                                            id="rate-uncovered-evening-nonmember" class="payment-input"
                                            style="width: 100%;" step="0.5"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="App.saveCourtRates()"
                        style="margin-top: 15px; width: 100%; padding: 15px; font-size: 1.1rem;">
                        ğŸ’¾ Salva Tutte le Configurazioni
                    </button>
                </div>

                <!-- Weekly Default Times Configuration - admin only -->
                <div class="section-card admin-only" style="margin-top: 20px; display: none;">
                    <h3>â° Orari Settimanali Predefiniti</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9rem;">
                        Configura gli orari predefiniti per ogni giorno della settimana. Questi verranno usati
                        automaticamente nel planning.
                    </p>

                    <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <!-- Court selector -->
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">ğŸ“
                                Seleziona Campo</label>
                            <select id="weekly-times-court-select" class="form-control"
                                style="width: 100%; padding: 10px;" onchange="App.renderWeeklyTimesUI()">
                                <!-- Options populated dynamically -->
                            </select>
                        </div>

                        <!-- Day tabs -->
                        <div class="weekly-day-tabs"
                            style="display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 15px;">
                            <button class="btn btn-outline weekly-day-tab active" data-day="lunedi"
                                onclick="App.selectWeeklyDay('lunedi')">Lun</button>
                            <button class="btn btn-outline weekly-day-tab" data-day="martedi"
                                onclick="App.selectWeeklyDay('martedi')">Mar</button>
                            <button class="btn btn-outline weekly-day-tab" data-day="mercoledi"
                                onclick="App.selectWeeklyDay('mercoledi')">Mer</button>
                            <button class="btn btn-outline weekly-day-tab" data-day="giovedi"
                                onclick="App.selectWeeklyDay('giovedi')">Gio</button>
                            <button class="btn btn-outline weekly-day-tab" data-day="venerdi"
                                onclick="App.selectWeeklyDay('venerdi')">Ven</button>
                            <button class="btn btn-outline weekly-day-tab" data-day="sabato"
                                onclick="App.selectWeeklyDay('sabato')">Sab</button>
                            <button class="btn btn-outline weekly-day-tab" data-day="domenica"
                                onclick="App.selectWeeklyDay('domenica')">Dom</button>
                        </div>

                        <!-- Times list -->
                        <div id="weekly-times-container"
                            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 8px; max-height: 250px; overflow-y: auto; margin-bottom: 15px;">
                            <!-- Time inputs populated dynamically -->
                        </div>

                        <!-- Add/Remove buttons -->
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <button class="btn btn-outline" onclick="App.addWeeklyTimeSlot()" style="flex: 1;">+
                                Aggiungi Orario</button>
                            <button class="btn btn-outline" onclick="App.removeWeeklyTimeSlot()" style="flex: 1;">-
                                Rimuovi Ultimo</button>
                        </div>

                        <!-- Copy to all days button -->
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <button class="btn btn-secondary" onclick="App.copyWeeklyTimesToAllDays()" style="flex: 1;">
                                ğŸ“‹ Copia a tutti i giorni
                            </button>
                        </div>

                        <!-- Save button -->
                        <button class="btn btn-primary" onclick="App.saveWeeklyDefaultTimes()"
                            style="width: 100%; padding: 12px;">
                            ğŸ’¾ Salva Orari Settimanali
                        </button>
                    </div>
                </div>

                <!-- PayPal Configuration - admin only -->
                <div class="section-card admin-only" style="margin-top: 20px; display: none;">
                    <h3>ğŸ’³ Configurazione Pagamenti</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9rem;">
                        Configura le credenziali PayPal per abilitare i pagamenti online.
                    </p>

                    <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="font-size: 1.5rem;">ğŸ…¿ï¸</span>
                            <h4 style="margin: 0; color: var(--text-primary);">PayPal</h4>
                            <span id="paypal-status-badge"
                                style="padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; background: #f59e0b; color: white;">Sandbox</span>
                        </div>

                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Client
                                ID</label>
                            <input type="text" id="paypal-client-id" placeholder="Inserisci il tuo PayPal Client ID"
                                style="width: 100%; padding: 10px; border-radius: 6px; background: #1e1e2e; color: #fff; border: 1px solid #444;">
                            <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 5px;">
                                Lascia "sb" per usare la modalitÃ  sandbox (test). Ottieni il tuo Client ID da
                                <a href="https://developer.paypal.com/dashboard/applications" target="_blank"
                                    style="color: #60a5fa;">developer.paypal.com</a>
                            </p>
                        </div>

                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="paypal-production-mode" onchange="App.togglePayPalMode()">
                                <span style="color: var(--text-primary);">ğŸ”´ ModalitÃ  Produzione (pagamenti
                                    reali)</span>
                            </label>
                            <p style="font-size: 0.75rem; color: #ef4444; margin-top: 5px; display: none;"
                                id="paypal-production-warning">
                                âš ï¸ ATTENZIONE: In modalitÃ  produzione i pagamenti saranno reali!
                            </p>
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="App.savePayPalConfig()" style="flex: 1;">
                                ğŸ’¾ Salva Configurazione
                            </button>
                            <button class="btn btn-secondary" onclick="App.testPayPalConnection()" style="flex: 1;">
                                ğŸ§ª Test Connessione
                            </button>
                        </div>
                    </div>

                    <div
                        style="background: rgba(96, 165, 250, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(96, 165, 250, 0.3);">
                        <h5 style="color: #60a5fa; margin-bottom: 10px;">ğŸ“– Come ottenere le credenziali PayPal</h5>
                        <ol style="color: var(--text-secondary); font-size: 0.85rem; padding-left: 20px; margin: 0;">
                            <li>Vai su <a href="https://developer.paypal.com/" target="_blank"
                                    style="color: #60a5fa;">developer.paypal.com</a></li>
                            <li>Accedi con il tuo account PayPal (o creane uno)</li>
                            <li>Vai su Apps & Credentials</li>
                            <li>Crea una nuova app o usa quella predefinita</li>
                            <li>Copia il <strong>Client ID</strong> (Sandbox per test, Live per produzione)</li>
                        </ol>
                    </div>
                </div>

                <!-- Stripe Configuration - admin only -->
                <div class="section-card admin-only" style="margin-top: 20px; display: none;">
                    <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="font-size: 1.5rem;">ğŸ’³</span>
                            <h4 style="margin: 0; color: var(--text-primary);">Stripe (Carte di Credito)</h4>
                            <span id="stripe-status-badge"
                                style="padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; background: #f59e0b; color: white;">Test
                                Mode</span>
                        </div>

                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Publishable
                                Key</label>
                            <input type="text" id="stripe-publishable-key" placeholder="pk_test_..."
                                style="width: 100%; padding: 10px; border-radius: 6px; background: #1e1e2e; color: #fff; border: 1px solid #444;">
                            <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 5px;">
                                Ottieni la tua chiave da
                                <a href="https://dashboard.stripe.com/apikeys" target="_blank"
                                    style="color: #60a5fa;">dashboard.stripe.com</a>
                            </p>
                        </div>

                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Payment
                                Link (opzionale)</label>
                            <input type="text" id="stripe-payment-link" placeholder="https://buy.stripe.com/..."
                                style="width: 100%; padding: 10px; border-radius: 6px; background: #1e1e2e; color: #fff; border: 1px solid #444;">
                            <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 5px;">
                                Alternativa: crea un Payment Link dalla dashboard Stripe per pagamenti piÃ¹ semplici
                            </p>
                        </div>

                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="stripe-production-mode" onchange="App.toggleStripeMode()">
                                <span style="color: var(--text-primary);">ğŸ”´ ModalitÃ  Produzione (pagamenti
                                    reali)</span>
                            </label>
                            <p style="font-size: 0.75rem; color: #ef4444; margin-top: 5px; display: none;"
                                id="stripe-production-warning">
                                âš ï¸ ATTENZIONE: In modalitÃ  produzione i pagamenti saranno reali!
                            </p>
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="App.saveStripeConfig()" style="flex: 1;">
                                ğŸ’¾ Salva Configurazione
                            </button>
                            <button class="btn btn-secondary" onclick="App.testStripeConnection()" style="flex: 1;">
                                ğŸ§ª Test Connessione
                            </button>
                        </div>
                    </div>

                    <div
                        style="background: rgba(139, 92, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(139, 92, 246, 0.3);">
                        <h5 style="color: #a78bfa; margin-bottom: 10px;">ğŸ§ª Carte di Test per Stripe</h5>
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">
                            <p style="margin: 0 0 8px 0;"><strong>âœ… Pagamento riuscito:</strong> <code
                                    style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">4242 4242 4242 4242</code>
                            </p>
                            <p style="margin: 0 0 8px 0;"><strong>âŒ Carta rifiutata:</strong> <code
                                    style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">4000 0000 0000 0002</code>
                            </p>
                            <p style="margin: 0;"><strong>ğŸ” Richiede 3D Secure:</strong> <code
                                    style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">4000 0025 0000 3155</code>
                            </p>
                            <p style="margin: 8px 0 0 0; font-size: 0.8rem; color: var(--text-muted);">Data: qualsiasi
                                futura | CVV: qualsiasi 3 cifre</p>
                        </div>
                    </div>
                </div>

                <!-- QR Code / Mobile Payment Configuration - admin only -->
                <div class="section-card admin-only" style="margin-top: 20px; display: none;">
                    <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="font-size: 1.5rem;">ğŸ“±</span>
                            <h4 style="margin: 0; color: var(--text-primary);">QR Code / Pagamenti Mobile</h4>
                            <span id="qrcode-status-badge"
                                style="padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; background: #10b981; color: white;">Attivo</span>
                        </div>

                        <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9rem;">
                            Configura un QR Code statico (es. link Satispay Business, PayPal.me o altro) da mostrare per
                            i pagamenti.
                        </p>

                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Etichetta
                                (es. Satispay)</label>
                            <input type="text" id="qr-label" placeholder="Satispay"
                                style="width: 100%; padding: 10px; border-radius: 6px; background: #1e1e2e; color: #fff; border: 1px solid #444;">
                        </div>

                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">URL o Dati
                                del QR Code</label>
                            <input type="text" id="qr-data" placeholder="https://..."
                                style="width: 100%; padding: 10px; border-radius: 6px; background: #1e1e2e; color: #fff; border: 1px solid #444;">
                            <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 5px;">
                                Inserisci il link che il cliente deve aprire scansionando il QR.
                            </p>
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="App.saveQRConfig()" style="flex: 1;">
                                ğŸ’¾ Salva Configurazione
                            </button>
                            <button class="btn btn-secondary" onclick="App.testQRGeneration()" style="flex: 1;">
                                ğŸ§ª Test Generazione
                            </button>
                        </div>

                        <!-- Preview Area -->
                        <div id="qr-config-preview"
                            style="margin-top: 15px; display: none; text-align: center; background: #fff; padding: 15px; border-radius: 8px;">
                            <p style="color: #333; margin-bottom: 10px; font-weight: bold;">Anteprima:</p>
                            <div id="qr-config-preview-container" style="display: inline-block;"></div>
                        </div>
                    </div>

                    <!-- Backup Section - admin only -->

                    <div class="section-card admin-only" style="margin-top: 20px; display: none;">
                        <h3>ğŸ’¾ Backup e Sincronizzazione</h3>

                        <!-- Firebase Status -->
                        <div id="firebase-status"
                            style="margin-bottom: 15px; padding: 10px; border-radius: 8px; background: var(--bg-card);">
                            <span id="firebase-status-icon">â³</span>
                            <span id="firebase-status-text">Verifica connessione Firebase...</span>
                        </div>

                        <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9rem;">
                            Salva i tuoi dati su file per evitare di perderli. Puoi ripristinarli in qualsiasi momento.
                        </p>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                            <button class="btn btn-primary" onclick="Storage.downloadBackup()">
                                ğŸ“¥ Scarica Backup
                            </button>
                            <label class="btn btn-secondary" style="cursor: pointer;">
                                ğŸ“¤ Carica Backup
                                <input type="file" accept=".json" style="display: none;"
                                    onchange="if(this.files[0]) { Storage.loadFromBackup(this.files[0]).then(() => { alert('Backup caricato! La pagina verrÃ  ricaricata.'); location.reload(); }).catch(e => alert('Errore: ' + e.message)); }">
                            </label>
                            <button class="btn btn-primary" id="migrate-firebase-btn"
                                onclick="Storage.migrateToFirebase()" style="background: #f59e0b;">
                                ğŸ”„ Migra a Firebase
                            </button>
                        </div>

                        <!-- Pulizia Prenotazioni Passate -->
                        <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                            <h4 style="margin-bottom: 15px; color: var(--text-primary);">ğŸ—‘ï¸ Pulizia Prenotazioni
                                Passate
                            </h4>

                            <!-- Auto cleanup setting -->
                            <div
                                style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                                    <label style="color: var(--text-secondary); font-size: 0.9rem;">
                                        ğŸ”„ Cancella automaticamente prenotazioni piÃ¹ vecchie di:
                                    </label>
                                    <select id="auto-cleanup-months"
                                        style="padding: 8px 12px; border-radius: 6px; background-color: #1e1e2e; color: #ffffff; border: 1px solid #444;">
                                        <option value="0">Mai (conserva tutto)</option>
                                        <option value="1">1 mese</option>
                                        <option value="2">2 mesi</option>
                                        <option value="3">3 mesi</option>
                                        <option value="4">4 mesi</option>
                                        <option value="6">6 mesi</option>
                                        <option value="12">1 anno</option>
                                    </select>
                                    <button class="btn btn-secondary" onclick="Storage.saveCleanupSettings()"
                                        style="padding: 8px 15px;">
                                        ğŸ’¾ Salva
                                    </button>
                                    <button class="btn btn-primary" onclick="Storage.runAutoCleanup()"
                                        style="padding: 8px 15px; background: #ef4444;">
                                        ğŸ—‘ï¸ Esegui Ora
                                    </button>
                                </div>
                                <p style="margin-top: 10px; font-size: 0.8rem; color: var(--text-muted);">
                                    La pulizia automatica verrÃ  eseguita all'apertura dell'app da parte di qualsiasi
                                    utente.
                                </p>
                            </div>

                            <!-- Manual date range cleanup -->
                            <div style="background: var(--bg-card); padding: 15px; border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                                    <label style="color: var(--text-secondary); font-size: 0.9rem;">
                                        ğŸ“… Cancella prenotazioni dal:
                                    </label>
                                    <input type="date" id="cleanup-date-from"
                                        style="padding: 8px 12px; border-radius: 6px; background-color: #1e1e2e; color: #ffffff; border: 1px solid #444;">
                                    <span style="color: var(--text-secondary);">al:</span>
                                    <input type="date" id="cleanup-date-to"
                                        style="padding: 8px 12px; border-radius: 6px; background-color: #1e1e2e; color: #ffffff; border: 1px solid #444;">
                                    <button class="btn btn-primary" onclick="Storage.cleanupByDateRange()"
                                        style="padding: 8px 15px; background: #ef4444;">
                                        ğŸ—‘ï¸ Cancella Range
                                    </button>
                                </div>
                                <p style="margin-top: 10px; font-size: 0.8rem; color: var(--text-muted);">
                                    âš ï¸ Questa operazione Ã¨ irreversibile. VerrÃ  chiesta conferma prima di procedere.
                                </p>
                            </div>
                        </div>
                    </div>
            </section>

            <!-- Players Tab -->
            <section id="players" class="tab-content">
                <div class="section-header">
                    <h2>Gestione Giocatori</h2>
                    <button class="btn btn-primary" id="add-player-btn">
                        <span>+</span> Nuovo Giocatore
                    </button>
                </div>

                <div class="filters-bar" style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                    <input type="text" id="player-search" placeholder="Cerca..." class="search-input" style="flex: 1;">
                    <select id="level-filter" class="search-input" style="width: auto; max-width: 200px;">
                        <option value="">Tutti i livelli</option>
                        <option value="principiante">Principiante</option>
                        <option value="intermedio">Intermedio</option>
                        <option value="avanzato">Avanzato</option>
                        <option value="agonista">Agonista</option>
                    </select>
                </div>

                <div class="players-table-container">
                    <table class="data-table players-extended-table" id="players-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th class="phone-cell">ğŸ“</th>
                                <th>Livello</th>
                                <th class="member-header">ğŸ…</th>
                                <th class="time-prefs-cell">ğŸ•’ Orari</th>
                                <th style="text-align: center;">Relazioni</th>
                                <th class="admin-only-column">Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="players-tbody">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Courts Tab -->
            <section id="courts" class="tab-content">
                <div class="section-header">
                    <h2>Gestione Campi</h2>
                    <button class="btn btn-primary" id="add-court-btn">
                        <span>+</span> Nuovo Campo
                    </button>
                </div>

                <div class="courts-grid" id="courts-grid">
                </div>
            </section>

            <section id="planning" class="tab-content">
                <!-- Date Navigation above table -->
                <div class="planning-date-nav">
                    <button class="btn-nav" onclick="App.changeDay(-1)">â—€ Ieri</button>
                    <div class="current-date">
                        <div class="day-name" id="current-day-name">GiovedÃ¬</div>
                        <div id="current-date-display">25/12/2024</div>
                    </div>
                    <button class="btn-nav" onclick="App.changeDay(1)">Domani â–¶</button>
                    <div class="date-picker-container"
                        style="margin-left: auto; display: flex; align-items: center; gap: 15px;">
                        <label for="planning-date-picker"
                            style="color: var(--text-secondary); font-size: 0.85rem; margin-right: 8px;">ğŸ“… Vai
                            a:</label>
                        <input type="date" id="planning-date-picker" class="date-picker-input"
                            onchange="App.goToDate(this.value)">
                        <button class="btn btn-secondary" onclick="App.printDailyPlanning()" title="Stampa giornata">
                            ğŸ–¨ï¸ Stampa
                        </button>
                    </div>
                </div>
                <input type="hidden" id="planning-date">

                <!-- View Selector -->
                <div class="view-selector"
                    style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; padding: 10px 15px; background: var(--bg-card); border-radius: var(--radius-md);">
                    <span style="color: var(--text-secondary); font-size: 0.9rem;">ğŸ“Š Vista:</span>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="planning-view" value="horizontal" checked
                            onchange="App.togglePlanningView('horizontal')">
                        <span style="color: var(--text-primary);">Orizzontale</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="planning-view" value="vertical"
                            onchange="App.togglePlanningView('vertical')">
                        <span style="color: var(--text-primary);">Verticale (con Quote)</span>
                    </label>
                </div>

                <div class="planning-container card">
                    <!-- Mobile Court Selector (visible only on mobile) -->
                    <div class="admin-mobile-court-selector" id="admin-mobile-court-selector">
                        <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                            <label>ğŸ“ Campo:</label>
                            <select id="admin-mobile-court-select" onchange="App.renderMobilePlanning()">
                                <!-- Options populated dynamically -->
                            </select>
                        </div>
                    </div>

                    <!-- Desktop: Top scrollbar -->
                    <div id="planning-top-scroll" class="desktop-planning-element"
                        style="overflow-x: auto; overflow-y: hidden; height: 16px; margin-bottom: 5px;">
                        <div id="planning-top-scroll-spacer" style="height: 1px;"></div>
                    </div>

                    <!-- Desktop: Horizontal tables -->
                    <div id="planning-flex-container" class="planning-flex-container desktop-planning-element">
                        <!-- Tables for each court injected by JS -->
                    </div>

                    <!-- Desktop: Vertical tables with quotes -->
                    <div id="planning-vertical-container" class="planning-vertical-container desktop-planning-element"
                        style="display: none;">
                        <!-- Vertical tables with quotes injected by JS -->
                    </div>

                    <!-- Mobile: Vertical table -->
                    <table class="admin-mobile-vertical-table" id="admin-mobile-planning-table">
                        <!-- Mobile table will be generated by JS -->
                    </table>
                </div>
                <div class="planning-legend">
                    <span class="legend-item"><span class="dot free"></span> Libero</span>
                    <span class="legend-item"><span class="dot confirmed"></span> Match</span>
                    <span class="legend-item"><span class="dot scuola"></span> Scuola</span>
                    <span class="legend-item"><span class="dot ago"></span> AGO</span>
                    <span class="legend-item"><span class="dot promo"></span> PROMO</span>
                    <span class="legend-item"><span class="dot torneo"></span> Torneo</span>
                    <span class="legend-item"><span class="dot manutenzione"></span> Manutenz.</span>
                    <span class="legend-item"><span class="dot reserved"></span> Bloccato</span>
                </div>
            </section>

            <!-- Recurring Planning Tab -->
            <section id="recurring" class="tab-content">
                <div class="section-header">
                    <h2>ğŸ” Planning Ricorrente</h2>
                </div>

                <div class="card" style="margin-bottom: 20px;">
                    <div class="recurring-config"
                        style="display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end;">
                        <div class="form-group" style="min-width: 150px;">
                            <label style="font-size: 0.85rem; margin-bottom: 5px; display: block;">Giorno</label>
                            <select id="recurring-day" class="form-control" style="width: 100%; padding: 8px 10px;">
                                <option value="1">LunedÃ¬</option>
                                <option value="2">MartedÃ¬</option>
                                <option value="3">MercoledÃ¬</option>
                                <option value="4">GiovedÃ¬</option>
                                <option value="5">VenerdÃ¬</option>
                                <option value="6">Sabato</option>
                                <option value="0">Domenica</option>
                            </select>
                        </div>
                        <div class="form-group" style="min-width: 150px;">
                            <label style="font-size: 0.85rem; margin-bottom: 5px; display: block;">Data Inizio</label>
                            <input type="date" id="recurring-start-date" class="form-control"
                                style="width: 100%; padding: 8px 10px;">
                        </div>
                        <div class="form-group" style="min-width: 150px;">
                            <label style="font-size: 0.85rem; margin-bottom: 5px; display: block;">Data Fine</label>
                            <input type="date" id="recurring-end-date" class="form-control"
                                style="width: 100%; padding: 8px 10px;">
                        </div>
                        <div class="form-group" style="min-width: 150px;">
                            <label style="font-size: 0.85rem; margin-bottom: 5px; display: block;">&nbsp;</label>
                            <button class="btn btn-primary" onclick="App.generateRecurringReservations()"
                                style="width: 100%; padding: 8px 10px;">
                                ğŸš€ Genera Prenotazioni
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Copy Day Section -->
                <div class="card" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">ğŸ“‹ Copia Giornata</h4>
                    <p style="margin-bottom: 15px; color: var(--text-secondary); font-size: 0.9rem;">
                        Copia tutte le prenotazioni da una data sorgente a una data di destinazione.
                    </p>
                    <div class="recurring-config"
                        style="display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end;">
                        <div class="form-group" style="min-width: 150px;">
                            <label style="font-size: 0.85rem; margin-bottom: 5px; display: block;">ğŸ“… Data
                                Sorgente</label>
                            <input type="date" id="copy-source-date" class="form-control"
                                style="width: 100%; padding: 8px 10px;">
                        </div>
                        <div class="form-group" style="min-width: 150px;">
                            <label style="font-size: 0.85rem; margin-bottom: 5px; display: block;">ğŸ“… Data
                                Destinazione</label>
                            <input type="date" id="copy-dest-date" class="form-control"
                                style="width: 100%; padding: 8px 10px;">
                        </div>
                        <div class="form-group" style="min-width: 150px;">
                            <label style="font-size: 0.85rem; margin-bottom: 5px; display: block;">&nbsp;</label>
                            <button class="btn btn-secondary" onclick="App.copyDayReservations()"
                                style="width: 100%; padding: 8px 10px;">
                                ğŸ“‹ Copia Prenotazioni
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <p style="margin-bottom: 15px; color: var(--text-secondary);">
                        Clicca sulle celle per impostare le attivitÃ  ricorrenti, poi premi "Genera Prenotazioni".
                    </p>

                    <!-- Mobile Court Selector for Recurring -->
                    <div class="admin-mobile-court-selector" id="recurring-mobile-court-selector">
                        <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                            <label>ğŸ“ Campo:</label>
                            <select id="recurring-mobile-court-select" onchange="App.renderRecurringMobilePlanning()">
                                <!-- Options populated dynamically -->
                            </select>
                        </div>
                    </div>

                    <!-- Desktop: Horizontal tables -->
                    <div id="recurring-flex-container" class="planning-flex-container"
                        style="overflow-x: auto; display: block;">
                        <!-- Tables for each court injected by JS -->
                    </div>

                    <!-- Mobile: Vertical table -->
                    <table class="admin-mobile-vertical-table" id="recurring-mobile-planning-table">
                        <!-- Mobile table will be generated by JS -->
                    </table>
                </div>
            </section>

            <!-- History Tab -->
            <section id="history" class="tab-content">
                <div class="section-header">
                    <h2>Storico Partite</h2>
                    <div class="history-filters">
                        <input type="date" id="history-from" class="date-input">
                        <span>a</span>
                        <input type="date" id="history-to" class="date-input">
                        <select id="history-type-filter" class="filter-select">
                            <option value="">Tutti i tipi</option>
                            <option value="singles">Singoli</option>
                            <option value="doubles">Doppi</option>
                        </select>
                    </div>
                </div>

                <div class="history-table-container">
                    <table class="data-table" id="history-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Ora</th>
                                <th>Campo</th>
                                <th>Tipo</th>
                                <th>Giocatori</th>
                                <th>Risultato</th>
                                <th>Feedback</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="history-tbody">
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal Template -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 id="modal-title">Titolo Modal</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
            </div>
            <div class="modal-footer" id="modal-footer">
            </div>
        </div>
    </div>

    <!-- Admin Authentication Script - MUST be first -->
    <script>
        // Password admin (modificabile)
        const ADMIN_PASSWORD = 'tennis';

        // Verifica se giÃ  loggato
        function checkAdminSession() {
            if (sessionStorage.getItem('admin_logged_in') === 'true') {
                showAdminArea();
            }
        }

        // Verifica password
        function checkAdminPassword() {
            const input = document.getElementById('admin-password');
            const error = document.getElementById('login-error');

            if (input.value === ADMIN_PASSWORD) {
                sessionStorage.setItem('admin_logged_in', 'true');
                showAdminArea();
            } else {
                error.style.display = 'block';
                input.value = '';
                input.focus();
            }
        }

        // Mostra area admin
        function showAdminArea() {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
        }

        // Check sessione all'avvio
        checkAdminSession();
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="js/firebase-config.js?v=8"></script>

    <!-- PayPal SDK - SANDBOX mode for testing -->
    <!-- To switch to production: replace sandbox client-id with your live client-id -->
    <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=EUR&intent=capture"
        data-sdk-integration-source="button-factory"></script>

    <!-- Stripe SDK -->
    <script src="https://js.stripe.com/v3/"></script>

    <!-- QRCode library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <!-- Scripts -->
    <script src="js/storage.js?v=7"></script>
    <script src="js/players.js?v=7"></script>
    <script src="js/courts.js?v=7"></script>
    <script src="js/availability.js?v=7"></script>
    <script src="js/matching.js?v=7"></script>
    <script src="js/history.js?v=7"></script>
    <script src="js/seed_players.js?v=7"></script>
    <script src="js/stripe.js?v=1"></script>
    <script src="js/app.js?v=8"></script>

    <!-- Admin access check -->
    <script>
        (function () {
            // Check if admin parameter is in URL
            const urlParams = new URLSearchParams(window.location.search);
            const isAdmin = urlParams.get('admin') === '1';

            // Expose globally for use in app.js
            window.isAdmin = isAdmin;

            if (isAdmin) {
                // Show admin-only elements
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = '';
                });
                console.log('ğŸ” ModalitÃ  Admin attivata');
            } else {
                // Non-admin mode: hide edit buttons for Giocatori/Campi sections
                document.body.classList.add('non-admin-mode');

                // Hide "Nuovo Giocatore" button
                const addPlayerBtn = document.getElementById('add-player-btn');
                if (addPlayerBtn) addPlayerBtn.style.display = 'none';

                // Hide "Nuovo Campo" button
                const addCourtBtn = document.getElementById('add-court-btn');
                if (addCourtBtn) addCourtBtn.style.display = 'none';

                // Non-admin: make sure players tab is shown as default
                setTimeout(() => {
                    if (typeof App !== 'undefined') {
                        App.showTab('players');
                    }
                }, 100);
            }
        })();
    </script>
</body>

</html>